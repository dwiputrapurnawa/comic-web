<%- include("../partials/header") %>
<%- include("../partials/navbar") %>

<main class="container-xl my-3">
    <div class="row">
        <div class="col-lg-8">
            <div class="comic-container row">
                <div class="col-lg-6 mb-3">
                    <div class="label-comic">
                        <%= comic.type.toUpperCase() %>
                    </div>
                    <img class="mb-3 w-100" style="display: block;" src="<%= comic.thumbnail.substring(7) %>" alt="" height="500" >
                    
                    <form action="/comics/add-bookmark" method="post">
                        <input type="hidden" name="comicId" value="<%= comic._id %>">
                        <button type="submit" class="btn btn-primary w-100" >

                            <% if (user) { %>
                             
                                <% if (user.bookmark.findIndex((bookmarkComic) => bookmarkComic.title === comic.title) === -1) { %>
                                    <i class="fa-regular fa-bookmark"></i> Bookmark

                                <% } else { %>
                                    <i class="fa-solid fa-bookmark"></i> Bookmarked</button>
                                <% } %>

                            <% } else { %>
                                <i class="fa-regular fa-bookmark"></i> Bookmark
                            <% } %>

                           
                             
                            
                            
                            
                    </form>
                    
                </div>
               <div class="col-lg-6">
                    
                    <h5><%= comic.title %></h5>
                    <% comic.genres.forEach(genre => { %>
                        <span class="badge bg-secondary mb-3"><%= genre.toUpperCase() %></span>
                    <% }) %>
                    <h6>Synopsis</h6>
                   <p><%= comic.synopsis %></p>
        
                   <div class="row">
                        <div class="col-lg-6">
                            <h6>Author</h6>
                            <span class="badge bg-secondary mb-3"><%= comic.author %></span>
                        </div>
        
                        <div class="col-lg-6">
                            <h6>Status</h6>
                            <span class="badge bg-secondary mb-3"><%= comic.status %></span>
                        </div>
        
                        <div class="col-lg-6">
                            <h6>Last Updated</h6>
                            <span class="badge bg-secondary mb-3"><%= comic.updatedAt.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"}) %></span>
                        </div>
        
                        <div class="col-lg-6">
                            <h6>Type</h6>
                            <span class="badge bg-secondary mb-3"><%= comic.type %></span>
                        </div>
                        
                   </div>
        
                  
        
               </div>
            </div>
        
            <div class="comic-container" id="readNow">
                <h4>Chapters</h4>
                <hr>
        
                <div class="row mb-3">
                   <div class="col-lg-6 mb-3">
                    <a class="btn btn-primary custom-button" href="/comics/<%= comic.titlePath %>/<%= comic.chapters[0].chapterPath %>">First Chapter</a>
                   </div>
                    <div class="col-lg-6 mb-3">
                        <a class="btn btn-primary custom-button" href="/comics/<%= comic.titlePath %>/<%= comic.chapters[comic.chapters.length-1].chapterPath %>">New Chapter</a>
                    </div>
                </div>
        
                <div class="chapter-overflow">

                    <% comic.chapters.reverse().forEach(chapter => { %>
                        <div class="chapter-container mb-2 me-3">
                            <a href="/comics/<%= comic.titlePath %>/<%= chapter.chapterPath %>">
                                <div class="row">
                                    <div class="col-lg-10">
                                        <h5>Chapter <%= chapter.number %></h5>
                                        <p><%= chapter.createdAt.toLocaleDateString('en-us', { weekday:"long", year:"numeric", month:"short", day:"numeric"}) %></p>
                                    </div>

                                    <div class="col-lg">
                                        <p><%= moment(chapter.createdAt).fromNow() %></p>
                                    </div>
                                </div>

                                
                            </a>
                        </div>
                    <% }) %>

                    
                
                </div>
                
                
            </div>
        
            <div class="comic-container">
                <h4>Comments</h4>
                <hr>
        
               <div class="row">
                <div class="col-lg-9">
                    <input class="form-control" type="text" name="comment" id="comment">
                </div>
                <div class="col-lg">
                    <button class="btn btn-primary w-100"><i class="fa-solid fa-comment"></i> Comment</button>
                </div>
               </div>
            </div>
        </div>

        <div class="col-lg">
            <div class="comic-container">
              <h5>Top Popular</h5>
            <hr>

            <div class="row">

                <% topPopular.forEach(comic => { %>
                  <div class="col-lg-12 row top-popular-item">
                      <div class="col-lg-4">
                          <img src="<%= comic.thumbnail.substring(7) %>" alt="" width="100" height="150" style="display: inline-block;">
                      </div>
                     <div class="col-lg-8">
                      <h5><a class="link-title-comic" href="/comics/<%= comic.titlePath %>"><%= comic.title.length > 50 ? comic.title.substring(0, 50) + "..." : comic.title %></a></h5>
  
                     <div class="rating mb-3">
                      <% for( let index = 0; index < comic.rating; index++ ) { %>
                        <i class="fa-solid fa-star"></i>
                      <% } %>
                     </div>
  
                      <% comic.genres.forEach(genre => { %>
                          <span class="badge bg-secondary"><%= genre %></span>
                      <% }) %>
                     </div>
                  
                  </div>
                  <hr>
              <% }) %>
  
              </div>

            </div>
        </div>
    </div>
</main>

<%- include("../partials/footer") %>